<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.514">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modelling Spatiotemporal Processes - 11&nbsp; Differential equations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./si6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./de1.html">Other topics</a></li><li class="breadcrumb-item"><a href="./de1.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Differential equations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelling Spatiotemporal Processes</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/mstp/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Time Series</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting and choosing models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Optimisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./op1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimization: linear and non-linear</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./op2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Optimization: stochastic methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Spatial Interpolation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simple approaches</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Unknown, constant mean</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Unknown, varying mean</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Local predictors, block kriging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./si6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Cokriging, cross validation, conditional simulation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Other topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./de1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Differential equations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#deterministic-spatial-dynamic-models" id="toc-deterministic-spatial-dynamic-models" class="nav-link active" data-scroll-target="#deterministic-spatial-dynamic-models"><span class="header-section-number">11.1</span> Deterministic spatial dynamic models</a>
  <ul class="collapse">
  <li><a href="#model-domain" id="toc-model-domain" class="nav-link" data-scroll-target="#model-domain">Model domain</a></li>
  <li><a href="#initial-conditions" id="toc-initial-conditions" class="nav-link" data-scroll-target="#initial-conditions">Initial conditions</a></li>
  <li><a href="#initial-conditions-2" id="toc-initial-conditions-2" class="nav-link" data-scroll-target="#initial-conditions-2">Initial conditions-2</a></li>
  <li><a href="#boundary-conditions" id="toc-boundary-conditions" class="nav-link" data-scroll-target="#boundary-conditions">Boundary conditions</a></li>
  <li><a href="#processes" id="toc-processes" class="nav-link" data-scroll-target="#processes">Processes</a></li>
  <li><a href="#solving-differential-equations" id="toc-solving-differential-equations" class="nav-link" data-scroll-target="#solving-differential-equations">Solving differential equations</a></li>
  <li><a href="#solving-pdes" id="toc-solving-pdes" class="nav-link" data-scroll-target="#solving-pdes">Solving PDE’s</a></li>
  <li><a href="#diffusion-equations-1-d" id="toc-diffusion-equations-1-d" class="nav-link" data-scroll-target="#diffusion-equations-1-d">Diffusion equations, 1-D</a></li>
  <li><a href="#forwardbackward-explicitimplicit" id="toc-forwardbackward-explicitimplicit" class="nav-link" data-scroll-target="#forwardbackward-explicitimplicit">Forward/backward, explicit/implicit</a></li>
  <li><a href="#calibrating-deterministic-models" id="toc-calibrating-deterministic-models" class="nav-link" data-scroll-target="#calibrating-deterministic-models">Calibrating deterministic models</a></li>
  <li><a href="#difficulties-in-calibration" id="toc-difficulties-in-calibration" class="nav-link" data-scroll-target="#difficulties-in-calibration">Difficulties in calibration</a></li>
  <li><a href="#more-difficulties" id="toc-more-difficulties" class="nav-link" data-scroll-target="#more-difficulties">More difficulties</a></li>
  <li><a href="#dynamic-parameter-updating-schemes" id="toc-dynamic-parameter-updating-schemes" class="nav-link" data-scroll-target="#dynamic-parameter-updating-schemes">Dynamic parameter updating schemes</a></li>
  <li><a href="#simplified-difference-equation-type-models" id="toc-simplified-difference-equation-type-models" class="nav-link" data-scroll-target="#simplified-difference-equation-type-models">Simplified difference equation-type models</a></li>
  <li><a href="#calibration-vs.-validation-of-models" id="toc-calibration-vs.-validation-of-models" class="nav-link" data-scroll-target="#calibration-vs.-validation-of-models">Calibration vs.&nbsp;validation of models</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/edzer/mstp/edit/master/de1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./de1.html">Other topics</a></li><li class="breadcrumb-item"><a href="./de1.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Differential equations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Differential equations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="deterministic-spatial-dynamic-models" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="deterministic-spatial-dynamic-models"><span class="header-section-number">11.1</span> Deterministic spatial dynamic models</h2>
<p>Deterministic models are based on the assumption that the processes governing change are known. Given that knowledge, we need</p>
<ul>
<li>the state of a system (initial conditions), and</li>
<li>the characteristics at boundaries of the system (boundary conditions): what are the sources and sinks, when does what escape or enter the modelled area.</li>
</ul>
<p>for a (perfect) prediction of the changes over time, and in space. Examples of output of such models include all prediction models, weather models, and <a href="https://atmosphere.copernicus.eu/">atmospheric composition models</a></p>
<p>Let us look at an example: air quality (fine particles, PM10).</p>
<section id="model-domain" class="level3">
<h3 class="anchored" data-anchor-id="model-domain">Model domain</h3>
<p>For a model, we need a <em>model domain</em>, which is the spatial area and temporal period over which we will define processes and conditions. This could be e.g.&nbsp;Western Europe, 1980-2010, or NRW, 2000-2005, or the area not further than 100 m away from the crossing Weseler Strasse-Bonhoeffer Strasse, Jan 8, 2008, 0:00-24:00. It should be exactly quantifiable/traceable.</p>
</section>
<section id="initial-conditions" class="level3">
<h3 class="anchored" data-anchor-id="initial-conditions">Initial conditions</h3>
<p>The initial conditions usually describe the variable of interest (the concentration field) at the highest possible level of detail. In our case this is the PM10 concentration field at the start of the modelling period.</p>
<p>As this is a continuous field, we need some way to describe this and usually the spatial domain is discretized into model usually square, rectuangular or triangular model elements.</p>
<p>This discretization should match the level of detail</p>
<ul>
<li>at which we know initial conditions and</li>
<li>at which we want to model features.</li>
</ul>
<p>As an example: if we want to quantify the effect of individual car fumes, spatial elements of 10 cm–1 m may work; if we want to describe the effect of a complete streets something of 10m–100m seems more appropriate. Smaller elements and time steps mean more memory and CPU time requirements.</p>
</section>
<section id="initial-conditions-2" class="level3">
<h3 class="anchored" data-anchor-id="initial-conditions-2">Initial conditions-2</h3>
<p>If we don’t know initial conditions exactly, we may put the starting point of the modelling domain further back in the past, and hope that the effect of approximation will damp out as we model. (This assumes we get the boundary conditions and processes right.)</p>
</section>
<section id="boundary-conditions" class="level3">
<h3 class="anchored" data-anchor-id="boundary-conditions">Boundary conditions</h3>
<p>PM10 comes and goes. Sources are (i) emissions inside the model domain (cars, households, industry), and (ii) material that enters the model domain by movement of air bodies, but emitted elsewhere. We need these source terms (points, lines or fields) in space, and over time.</p>
<p>Sinks are mostly air that moves out of the model domain, and wash out (rain), dry deposition (your grandmother’s white sheets turning black), and … inhalation. These terms are also needed, quantitatively.</p>
</section>
<section id="processes" class="level3">
<h3 class="anchored" data-anchor-id="processes">Processes</h3>
<p>Particles move mostly for two or three reasons: by large-scale movement of air (wind), by medium/small-scale movement of air (turbulence, dispersion) and by themselves (diffusion; think Brownian motian of a single particle in a gas).</p>
<p>As an example, take a look at the <a href="https://www.lotos-euros.nl/">LOTOS-EUROS</a> model documentation.</p>
<p>As you can read in the <em>model formulation and domain</em>, the model uses external modelling results (interpolation or mechanistic modelling) to get the atmospheric driving forces (height mixing layer, wind fields), e.g.&nbsp;from FUB and <a href="https://www.ecmwf.int/">ECMWF</a>.</p>
<p>Basically, the model <em>code</em></p>
<ul>
<li>reads a lot of initial and boundary data,</li>
<li>solves the differential equations and</li>
<li>writes out everything that is of interest, such as the space-time concentration fields.</li>
</ul>
</section>
<section id="solving-differential-equations" class="level3">
<h3 class="anchored" data-anchor-id="solving-differential-equations">Solving differential equations</h3>
<p>The partial differential equation solved in LOTOS_EUROS is the <a href="http://en.wikipedia.org/wiki/Continuity_equation">continuity equation</a> <span class="math display">\[
\frac{\delta C}{\delta t} +
U\frac{\delta C}{\delta x} +
V\frac{\delta C}{\delta y} +
W\frac{\delta C}{\delta z} \]</span> <span class="math display">\[
= \frac{\delta}{\delta x}(K_h \frac{\delta C}{\delta x})  +
\frac{\delta}{\delta y}(K_h \frac{\delta C}{\delta y})  +
\frac{\delta}{\delta z}(K_z \frac{\delta C}{\delta z})  +E+R+Q-D-W
\]</span> with (mostly quoted from the <a href="https://lotos-euros.tno.nl/media/10360/reference_guide_v2-0_r10898.pdf">reference guide</a>, page 6/7:</p>
<ul>
<li><span class="math inline">\(t,x,y,z\)</span> time and the three space dimensions</li>
<li><span class="math inline">\(C\)</span> concentration of the pollutant (dynamic field)</li>
<li><span class="math inline">\(U,V,W\)</span> the large scale wind components in respectively west-east direction, in south-north direction and in vertical direction</li>
<li><span class="math inline">\(K_h,K_z\)</span> the horizontal and vertical turbulent diffusion coefficients</li>
<li><span class="math inline">\(E\)</span> the entrainment or detrainment due to variations in layer height.</li>
<li><span class="math inline">\(R\)</span> the amount of material produced or destroyed as a result of chemistry.</li>
<li><span class="math inline">\(Q\)</span> is the contribution by emissions,</li>
<li><span class="math inline">\(D\)</span> and <span class="math inline">\(W\)</span> loss terms due to processes of dry and wet deposition respectively</li>
</ul>
<p>To solve this equation, it needs to be discretized in space and time. For this particular model, the spatial grid size is 0.5 degree longitude <span class="math inline">\(\times\)</span> 0.25 degree latitude (meaning that grid cells do not have constant area), and time step is 1h.</p>
</section>
<section id="solving-pdes" class="level3">
<h3 class="anchored" data-anchor-id="solving-pdes">Solving PDE’s</h3>
<p>The simples method to solve PDE’s by discretization is, <em>finite difference</em>, uses a regular mesh size, <span class="math inline">\(\Delta x\)</span>. The solution is computed at location <span class="math inline">\(j \Delta x\)</span>, with <span class="math inline">\(j=1,...,N\)</span>.</p>
<p>In one dimension the first derivative uses one of the three approximations:</p>
<ul>
<li>backward: <span class="math display">\[\frac{\delta u}{\delta x}(j \Delta x) \approx \frac{u_j-u_{j-1}}{\Delta x} \]</span></li>
<li>forward: <span class="math display">\[\frac{\delta u}{\delta x}(j \Delta x) \approx \frac{u_{j+1}-u_{j}}{\Delta x} \]</span></li>
<li>centered: <span class="math display">\[\frac{\delta u}{\delta x}(j \Delta x) \approx \frac{u_{j+1}-u_{j-1}}{2\Delta x} \]</span> and for the second order derivative (centered): <span class="math display">\[\frac{\delta^2 u}{\delta x^2}(j \Delta x) \approx \frac{u_{j+1}-2u_j+u_{j-1}}{(\Delta x)^2} \]</span></li>
</ul>
</section>
<section id="diffusion-equations-1-d" class="level3">
<h3 class="anchored" data-anchor-id="diffusion-equations-1-d">Diffusion equations, 1-D</h3>
<p>Diffusion happens in space-time. Using a mesh in space-time, we can write <span class="math inline">\(u(j \Delta x, n \Delta t) \approx u^n_j\)</span> with <span class="math inline">\(n\)</span> a superscript, not power.</p>
<p>We can approximate the PDE <span class="math display">\[\frac{\delta u}{\delta t} = \frac{\delta^2 u}{\delta x^2}, \ \mbox{with} \ u(x,0)=\phi(x) \]</span></p>
<p>by finite difference, in time: <span class="math display">\[\frac{\delta u}{\delta t}(j \Delta x, n \Delta t) \approx \frac{u_{j}^{n+1}-u_{j}^n}{\Delta t}\]</span> and space: <span class="math display">\[\frac{\delta u}{\delta x}(j \Delta x, n \Delta t) \approx \frac{u_{j+1}^{n}-u_j^n}{\Delta x}\]</span></p>
<p>Using forward difference for <span class="math inline">\(t\)</span> and centered for <span class="math inline">\(x\)</span>, combining both, the corresponding finite difference equation that approximates the PDE it is: <span class="math display">\[\frac{u_j^{n+1}-u_j^n}{\Delta t} = \frac{u^n_{j+1}-2u_j^n+u_{j-1}^n}{(\Delta x)^2}.\]</span></p>
</section>
<section id="forwardbackward-explicitimplicit" class="level3">
<h3 class="anchored" data-anchor-id="forwardbackward-explicitimplicit">Forward/backward, explicit/implicit</h3>
<p>Solving <span class="math display">\[\frac{u_j^{n+1}-u_j^n}{\Delta t} = \frac{u^n_{j+1}-2u_j^n+u_{j-1}^n}{(\Delta x)^2}.\]</span> is trivial, as <span class="math inline">\(n+1\)</span> is only in the LHS. This means that for each <span class="math inline">\(x\)</span> we can solve the equation explicitly, where we start is not important. They require, for stable solutions, that <span class="math inline">\(\frac{\Delta t}{(\Delta x)^2} \le \frac{1}{2}\)</span>. See examples.</p>
<p>If the equation were instead <span class="math display">\[\frac{u_j^{n+1}-u_j^n}{\Delta t} = \frac{u^{n+1}_{j+1}-2u_j^{n+1}+u_{j-1}^{n+1}}{(\Delta x)^2}.\]</span> then we have the unknown <span class="math inline">\(u^{n+1}\)</span> both left and right of the equal sign. This requires the solution of a (sparse) set of coupled linear equations, and this solution is called <em>implicit</em>. It pays off: the solutions are stable, and larger time steps can be chosen (provided of course, that change is close to linear over the time step).</p>
</section>
<section id="calibrating-deterministic-models" class="level3">
<h3 class="anchored" data-anchor-id="calibrating-deterministic-models">Calibrating deterministic models</h3>
<p>Models based on partial differential equations have parameters; think of diffusion parameters, source and sink terms (boundary conditions), and initial conditions. These need to be filled in, somehow.</p>
<p>Given that observation data on the model outcome are available, one way to fill these in is to search for values such that the model predictions best fit the data. We have seen methods for this; there is a long list of further, possibly more advanced or efficient methods for finding optimal parameter values, both in a deterministic (<em>optimum</em>) sense, and in a stochastic (<em>distribution</em>) sense.</p>
<p>Also, choosing optimality criterium (least squares? least absolute differences? combined criteria over multiple variables?)</p>
</section>
<section id="difficulties-in-calibration" class="level3">
<h3 class="anchored" data-anchor-id="difficulties-in-calibration">Difficulties in calibration</h3>
<p>Problems that may occur with calibrating models are numerous.</p>
<p>One problem may be that the parameter we tune (optimize) is not constant over space or time, but varies. This means that there instead of one single value, there may be numerous. Their number may outnumber the observations, and in that case there is little hope in finding realistic values.</p>
<p>Another problem is that we may tune a parameter and get a better fit, but that in reality we turned the wrong button, meaning we get a better fit <em>for the wrong reason</em>. This may have disasterous effects when using this <em>optimized</em> model in a prediction setting (such as future forecasting, or scenario evaluation).</p>
<p>Automatic codes exist (e.g.&nbsp;PEST, or ‘’optim’’ in R) that optimize models, irrespective what the model is or does.</p>
</section>
<section id="more-difficulties" class="level3">
<h3 class="anchored" data-anchor-id="more-difficulties">More difficulties</h3>
<p>Deterministic models use a temporal and spatial discretization. This is a balance between CPU and memory costs, and the ability to fill the discrete elements sensibly. Processes need to be <em>lumped</em>, meaning that they cannot be taken into account because of the grid cell size (think of convection above a forest, or a thunder storm, when grid cell size is 50 km, and/or time step a day). Choosing a finer resolution, the parameters, processes, boundary and initial values need to be filled in with much more resolution (precision), and need disaggregation – e.g.&nbsp;a country total emission may need to be assigned to 1 km <span class="math inline">\(\times\)</span> 1 km grid cells.</p>
</section>
<section id="dynamic-parameter-updating-schemes" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-parameter-updating-schemes">Dynamic parameter updating schemes</h3>
<p>A probabilistic setting of a deterministic model is that of the <em>Kalman filter</em>. This algorithm assumes measurements are a combination of a true state and a measurement noise. Each component has its particular error structure, expressed by a mean and covariance matrix.</p>
<p>For each new time step, the model predicts a new state, the observations are compared to that new state, and the model errors are used to adjust (improve) the model before predicting the next step.</p>
<p>Kalman filters are used a lot to optimize deterministic models, and come nowadays in many flavours, e.g.&nbsp;depending on whether the model is linear or not, and whether it is used forward in time, or in real-time.</p>
<p><em>Particle filters</em> do this in a stochastic setting.</p>
</section>
<section id="simplified-difference-equation-type-models" class="level3">
<h3 class="anchored" data-anchor-id="simplified-difference-equation-type-models">Simplified difference equation-type models</h3>
<p>Often, the differential equations are simplified very crudely to the state where only mass is preserved, but the solution no longer approximates the true differential equation. Think of simple bucket-type models in hydrology, where water bodies are buckets and soils are like sponges: a soil grid cell drains always with an exponential decrease; a soil and water body grid cells drain <em>instantly</em> when their maximum capacity is exceeded, with the amount it is exceeded.</p>
<p>Despite the simplifications, these models can be more useful than attempts to solve the full differential equation, because their data demand can be more realistically met.</p>
</section>
<section id="calibration-vs.-validation-of-models" class="level3">
<h3 class="anchored" data-anchor-id="calibration-vs.-validation-of-models">Calibration vs.&nbsp;validation of models</h3>
<p><em>Validation</em> of models involves assessing their validity, or value, and is a principally different activity from <em>calibration</em>. Where <em>calibration</em> is an optimization, <em>validation</em> is an assessment. The validation may be quantitative (“the mean square prediction error of the model is 0.75”) or qualitative (“the model is fit for its purpose”).</p>
<p><em>Validation</em> may also involve model comparison: the comparison of different models having different model <em>structure</em>, and can in that sense be seen as an abstraction over calibration:</p>
<ul>
<li>calibration compares the models that have identical structure, but have different parameter values</li>
<li>validation compares models that differ in structure</li>
</ul>
<p>Model comparison, in th course, would e.g.&nbsp;be:</p>
<ul>
<li>comparison of AR(1), AR(2), …, AR(n) to describe a particular time series</li>
<li>comparison of ordinary kriging, universal kriging with predictor <span class="math inline">\(X_1\)</span>, and universal kriging with predictor <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> for a given interpolation problem.</li>
</ul>
<p>In this case, the models compared are nested (i.e., AR(1) is a special case of AR(2), etc), which may simplify the problem to testing the significance of the extension (is the additional parameter significantly different from zero?) If they are not nested, comparison becomes harder, conceptually.</p>
<p>A famous model comparison on the other end of the extreme is that of the <em>coupled model intercomparison project</em>, CMIP, e.g.&nbsp;<a href="https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6">CMIP</a>; it involves large, international groups of climate scientists who agree, prior to the experiment, which models to compare.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./si6.html" class="pagination-link  aria-label=" &lt;span="" cross="" validation,="" conditional="" simulation&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Cokriging, cross validation, conditional simulation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>